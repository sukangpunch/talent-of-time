# 시대인재 스케줄링 시스템 요구사항

## 1. 서비스 개요

시대인재 학원 알바생(크루)의 일일 업무 스케줄을 관리하는 시스템.
크루별 작업 수행 횟수(count)를 기반으로 업무를 공평하게 분배하고,
강사별 세팅 정보·스케줄 현황을 조교들이 실시간으로 확인할 수 있도록 한다.

---

## 2. 도메인 모델

| 도메인 | 설명 |
|--------|------|
| **Crew** | 알바생(조교). 유형(CrewType)에 따라 근무 시간대가 다름. 인증 정보(username/password/email/role) 포함 |
| **CrewType** | `MORNING` (오전) / `MIDDLE` (미들) / `AFTERNOON` (오후) |
| **CrewRole** | `ADMIN` (리더급) / `USER` (일반 조교) |
| **Classroom** | 강의실 (603, 604, 605, 606호 등) |
| **Period** | 0교시(세팅) ~ 6교시. 교시별 시작/종료 시간 |
| **Teacher** | 강사 정보 및 강의실 세팅 방식 |
| **ClassSession** | 날짜 + 교시 + 강의실 + 강사 매핑. "언제 어느 교실에 누가 강의하는지" |
| **Schedule** | 날짜 × 교시 × 강의실 × 작업유형 × 크루 배정 결과 |
| **Count** | 크루별 작업유형별 누적 수행 횟수 |

### 작업 유형 (TaskType)

| 유형 | 설명 | 작업 시작 시간 기준 |
|------|------|---------------------|
| `SETTING` (세팅) | 수업 시작 전 교실·조그 장비·강사 대기실 준비 | 08:00 이전 |
| `ENTRY` (입실) | 수업 시작 25분 전 ~ 수업 시작. 학생 안내 및 라이브러리 배부 | 교시별 상이 |
| `JOG` (조그) | 수업 시작 5분 전 착석 ~ 수업 종료(약 100분). 녹화 및 인코딩 | 교시별 상이 |
| `EXIT` (퇴실) | 수업 종료 10분 전 대기. 퇴실자료 배부, 칠판 정리, 다음 수업 세팅 | 교시별 상이 |
| `EXAM` (시험) | 시험 있는 수업의 감독 (수업 시작 ~ +30분, 보통 2명) | 교시별 상이 |

---

## 3. 크루 유형 및 근무 시간

| 크루 유형 | 출근 시간 | 퇴근 시간 | 인원 수 |
|-----------|-----------|-----------|---------|
| 오전 | ~08:00 이전 | ~17:00 | 3명 |
| 미들 | 09:00 | 17:00 | 2명 |
| 오후 | 14:20 | 22:00 | 3명 |

> 미들 크루는 09:00 출근이므로, 09:00 이전에 시작하는 작업에는 배정 불가.

---

## 4. 교시 정보 및 작업 시작 시간

| 교시 | 수업 시간 | 입실 시작 | 조그 시작 | 퇴실 시작 |
|------|-----------|-----------|-----------|-----------|
| 세팅 | 08:30 이전 | - | - | - |
| 1교시 | 08:30 ~ 10:10 | 08:00 | 08:25 | 10:00 |
| 2교시 | 10:30 ~ 12:10 | 10:00 | 10:25 | 12:00 |
| 3교시 | 13:20 ~ 15:00 | 12:55 | 13:15 | 14:50 |
| 4교시 | 15:20 ~ 17:00 | 14:55 | 15:15 | 16:50 |
| 5교시 | 18:20 ~ 20:00 | 17:55 | 18:15 | 19:50 |
| 6교시 | 20:20 ~ 22:00 | 19:55 | 20:15 | 21:50 |

---

## 5. 교시·작업별 배정 가능 크루 유형 (핵심 제약)

> **이 표가 스케줄링 로직의 핵심이다. 구현 시 반드시 이 표를 기준으로 배정 풀을 결정한다.**

| 교시 | 작업 | 배정 가능 크루 | 비고 |
|------|------|----------------|------|
| 세팅 | SETTING | **오전 only** | 미들은 09:00 출근이므로 불가 |
| 1교시 | ENTRY | **오전 only** | 입실 시작 08:00 → 미들 출근 전 |
| 1교시 | JOG | **오전 only** | 조그 시작 08:25 → 미들 출근 전 |
| 1교시 | EXIT | **오전 + 미들** | 퇴실 시작 10:00 → 미들 이미 출근 |
| 2교시 | ENTRY, JOG, EXIT | **오전 + 미들** | 10:00 이후 → 미들 출근 후 |
| 3교시 | ENTRY, JOG | **오전 + 미들** | 12:55 이후 → 미들 출근 후 |
| 3교시 | EXIT | **오후 only** | 14:50 이후 → 오후 출근(14:20) 후. 오전은 퇴근 예정 |
| 4교시 | ENTRY, JOG, EXIT | **미들 + 오후** | 오전 퇴근 후 |
| 5교시 | ENTRY, JOG, EXIT | **오후 only** | 미들 퇴근(17:00) 후 |
| 6교시 | ENTRY, JOG, EXIT | **오후 only** | 미들 퇴근(17:00) 후 |

### 요약

```
세팅        → 오전만
1교시 입실  → 오전만   (08:00 시작, 미들 출근 전)
1교시 조그  → 오전만   (08:25 시작, 미들 출근 전)
1교시 퇴실  → 오전+미들 (10:00 시작, 미들 이미 출근)
2교시 전체  → 오전+미들
3교시 입실  → 오전+미들
3교시 조그  → 오전+미들
3교시 퇴실  → 오후만   (오후 인원이 3교시 퇴실 전담)
4교시 전체  → 미들+오후 (오전 퇴근)
5교시 전체  → 오후만   (미들 퇴근 후)
6교시 전체  → 오후만   (미들 퇴근 후)
```

---

## 6. Count 기반 공평 배정 알고리즘

### 배정 풀(Pool) 정의

배정 시 **배정 가능 크루 유형** 내에서만 count를 비교한다. 서로 다른 풀의 크루끼리는 count를 비교하지 않는다.

| 배정 풀 | 포함 크루 유형 |
|---------|----------------|
| 오전 pool | 오전 |
| 오전+미들 pool | 오전, 미들 |
| 오후 pool | 오후 |
| 미들+오후 pool | 미들, 오후 |

### 배정 알고리즘

```
1. 해당 교시+작업 조합에 해당하는 배정 가능 pool 내 크루 목록을 가져온다.
2. 해당 작업 유형의 누적 count가 가장 낮은 크루를 우선 배정한다.
3. count가 동일한 경우: 이름 오름차순(가나다순)으로 배정한다.
4. 동일 교시 내 이미 배정된 크루(busyCrewIds)는 후순위로 밀린다.
5. 배정 확정 시 해당 크루의 해당 작업 count +1
```

### Count 갱신 규칙

- 배정 확정 시 해당 크루원의 해당 작업 유형 count +1
- 작업 자기 등록 시 count +1 / 등록 취소 시 count -1
- 작업 교환 시: 교환 전 작업 count -1, 교환 후 작업 count +1
- ClassSession 수정/삭제 시: 연결된 Schedule 삭제 + count 복구

---

## 7. 스케줄링 실행 흐름

```
[Step 1] 세팅 배정       → 오전 pool (count 기반), 1교시와 독립 시행
[Step 2] 1교시 배정      → 입실·조그: 오전 pool / 퇴실: 오전+미들 pool
[Step 3] 2교시 배정      → 입실·조그·퇴실 모두 오전+미들 pool
[Step 4] 3교시 배정      → 입실·조그: 오전+미들 pool / 퇴실: 오후 pool
[Step 5] 4교시 배정      → 입실·조그·퇴실 모두 미들+오후 pool
[Step 6] 5·6교시 배정   → 입실·조그·퇴실 모두 오후 pool
```

---

## 8. 특수 규칙

| 규칙 | 내용 |
|------|------|
| 세팅과 1교시는 독립 시행 | 세팅 배정 결과가 1교시 배정에 영향을 주지 않는다 |
| 입실+조그 겸임 가능 | 인원 부족 시 한 크루원이 입실 후 조그를 이어서 수행. 두 count 모두 +1 |
| 시험 예외 | 시험이 있는 수업에 한해 EXAM 작업 추가 배정. 보통 2명 필요, 수업 시작 ~ +30분 |
| 작업 교환 | 두 크루원 합의 시 작업 교환 가능. count 조정으로 공평성 유지 |
| 동시간대 중복 최소화 | 같은 교시에 여러 강의실이 있을 때 busyCrewIds로 동일 크루 중복 배정 방지 |

---

## 9. 주간 수업 일정 관리

- 매 주 일요일에 다음 주(월~금) 수업 일정 확정 및 등록
- 등록 단위: **날짜 + 교시 + 강의실 + 강사(선택)** 조합
- 수업 일정 등록 완료 후 크루 배정(스케줄링) 실행
- 수업 일정 수정/삭제 시 연결된 스케줄 자동 삭제 + count 복구

---

## 10. 강사별 강의실 세팅 정보 (Teacher)

조교들이 앱에서 강사별 세팅 방법을 바로 확인할 수 있도록 저장한다.

| 항목 | 설명 |
|------|------|
| `name` | 강사 성함 |
| `chalkType` | 분필 종류: `SCHOOL`(학원분필) / `PERSONAL`(개인분필) / `BOTH`(혼합) |
| `chalkDetail` | 분필 세팅 상세 (수량, 위치 등) |
| `eraserDetail` | 지우개 세팅 상세 |
| `micType` | 마이크 종류: `SCHOOL`(학원마이크) / `PERSONAL`(개인마이크) |
| `hasPpt` | PPT(빔프로젝터) 사용 여부 |
| `pptDetail` | PPT 관련 특이사항 |
| `notes` | 기타 특이사항 자유 텍스트 |
| `lectureEmailRecipient` | 강의 영상 이메일 수신 주소 (nullable) |

기본 세팅 기준:
- 마이크 커버: 매 교시 교체
- 마이크 배터리: 1교시 수업 전, 2·4교시 수업 종료 후 교체 (2칸 이하면 교시 무관 즉시 교체)
- 분필 기본 세팅(학원분필): 흰2 노1 빨1 파1
- 기본 지우개 세팅: 4개
