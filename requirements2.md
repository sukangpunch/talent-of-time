# 시대인재 스케줄링 시스템 - 요구사항 v2

> **목적**: 구현 시 혼동을 방지하기 위해 크루 유형별 배정 가능 범위와 교시별 제약을 명확히 기술한다.

---

## 1. 크루 유형 및 근무 시간

| 크루 유형 | 출근 시간 | 퇴근 시간 | 인원 수 |
|-----------|-----------|-----------|---------|
| 오전      | ~08:00 이전 | ~17:00  | 3명     |
| 미들      | 09:00     | 17:00     | 2명     |
| 오후      | 14:20     | 22:00     | 3명     |

> **핵심**: 미들 크루는 09:00 출근이므로, 09:00 이전에 시작하는 작업에는 배정 불가.

---

## 2. 작업 유형 (TaskType)

| 작업 유형 | 설명 | 작업 시작 시간 기준 |
|-----------|------|---------------------|
| 세팅      | 수업 시작 전 교실·조그 장비·강사 대기실 준비 | 08:00 이전 |
| 입실      | 수업 시작 25분 전 ~ 수업 시작. 학생 안내 및 라이브러리 배부 | 교시별 상이 (아래 참고) |
| 조그      | 수업 시작 5분 전 착석 ~ 수업 종료(약 100분). 녹화 및 인코딩 | 교시별 상이 (아래 참고) |
| 퇴실      | 수업 종료 10분 전 대기. 퇴실자료 배부, 칠판 정리, 다음 수업 세팅 | 교시별 상이 (아래 참고) |
| 시후      | 시험 있는 수업의 감독 (수업 시작 ~ +30분, 보통 2명) | 교시별 상이 |

---

## 3. 교시 정보 및 작업 시작 시간

| 교시  | 수업 시간         | 입실 시작 | 조그 시작 | 퇴실 시작 |
|-------|-------------------|-----------|-----------|-----------|
| 세팅  | 08:30 이전        | -         | -         | -         |
| 1교시 | 08:30 ~ 10:10     | 08:00     | 08:25     | 10:00     |
| 2교시 | 10:30 ~ 12:10     | 10:00     | 10:25     | 12:00     |
| 3교시 | 13:20 ~ 15:00     | 12:55     | 13:15     | 14:50     |
| 4교시 | 15:20 ~ 17:00     | 14:55     | 15:15     | 16:50     |

---

## 4. 교시·작업별 배정 가능 크루 유형 (핵심 제약)

> **이 표가 스케줄링 로직의 핵심이다. 구현 시 반드시 이 표를 기준으로 배정 풀을 결정한다.**

| 교시  | 작업 유형 | 배정 가능 크루 | 비고 |
|-------|-----------|----------------|------|
| 세팅  | 세팅      | **오전 only**  | 미들은 09:00 출근이므로 불가 |
| 1교시 | 입실      | **오전 only**  | 입실 시작 08:00 → 미들 출근 전 |
| 1교시 | 조그      | **오전 only**  | 조그 시작 08:25 → 미들 출근 전 |
| 1교시 | 퇴실      | **오전 + 미들** | 퇴실 시작 10:00 → 미들 이미 출근 |
| 2교시 | 입실      | **오전 + 미들** | 10:00 이후 → 미들 출근 후 |
| 2교시 | 조그      | **오전 + 미들** | 10:25 이후 → 미들 출근 후 |
| 2교시 | 퇴실      | **오전 + 미들** | 12:00 이후 → 미들 출근 후 |
| 3교시 | 입실      | **오전 + 미들** | 12:55 이후 → 미들 출근 후 |
| 3교시 | 조그      | **오전 + 미들** | 13:15 이후 → 미들 출근 후 |
| 3교시 | 퇴실      | **오후 only**  | 14:50 이후 → 오후 출근(14:20) 후. 오전은 퇴근 예정 |
| 4교시 | 입실      | **미들 + 오후** | 오전 퇴근 후 |
| 4교시 | 조그      | **미들 + 오후** | 오전 퇴근 후 |
| 4교시 | 퇴실      | **미들 + 오후** | 오전 퇴근 후 |

### 요약 (외우기 쉬운 버전)

```
세팅        → 오전만
1교시 입실  → 오전만   (08:00 시작, 미들 출근 전)
1교시 조그  → 오전만   (08:25 시작, 미들 출근 전)
1교시 퇴실  → 오전+미들 (10:00 시작, 미들 이미 출근)
2교시 전체  → 오전+미들
3교시 입실  → 오전+미들
3교시 조그  → 오전+미들
3교시 퇴실  → 오후만   (오후 인원이 3교시 퇴실 전담)
4교시 전체  → 미들+오후 (오전 퇴근)
```

---

## 5. Count 기반 공평 배정 알고리즘

### 5.1 Count Pool 정의

배정 시 **배정 가능 크루 유형** 내에서 count를 비교한다. 서로 다른 풀의 크루끼리는 count를 비교하지 않는다.

| 배정 풀       | 포함 크루 유형 |
|---------------|----------------|
| 오전 pool     | 오전           |
| 오전+미들 pool | 오전, 미들     |
| 오후 pool     | 오후           |
| 미들+오후 pool | 미들, 오후     |

### 5.2 배정 알고리즘

1. 해당 교시+작업 조합에 해당하는 **배정 가능 pool** 내 크루 목록을 가져온다.
2. 해당 작업 유형의 누적 count가 가장 낮은 크루원을 우선 배정한다.
3. count가 동일한 경우: 이름 오름차순(가나다순)으로 배정한다.
4. 강의실 수가 인원보다 많으면, count가 낮은 순으로 한 명이 두 강의실을 커버할 수 있다.

### 5.3 Count 갱신

- 배정 확정 시 해당 크루원의 해당 작업 유형 count +1
- 작업 교환 시: 교환 전 작업 count -1, 교환 후 작업 count +1

---

## 6. 스케줄링 순서 (실행 흐름)

```
[Step 1] 세팅 배정
  - 배정 pool: 오전 크루 (count 기반)
  - 1교시와 독립 시행 (세팅 완료 후 1교시 배정 시작)

[Step 2] 1교시 배정
  - 입실: 오전 pool (count 기반)
  - 조그: 오전 pool (count 기반)
  - 퇴실: 오전+미들 pool (count 기반)

[Step 3] 2교시 배정
  - 입실, 조그, 퇴실 모두: 오전+미들 pool (count 기반)

[Step 4] 3교시 배정
  - 입실: 오전+미들 pool (count 기반)
  - 조그: 오전+미들 pool (count 기반)
  - 퇴실: 오후 pool (count 기반)

[Step 5] 4교시 배정 (오전 퇴근 후)
  - 입실, 조그, 퇴실 모두: 미들+오후 pool (count 기반)
```

---

## 7. 특수 규칙

### 7.1 세팅과 1교시는 독립 시행

- 세팅 배정 결과가 1교시 배정에 영향을 주지 않는다.
- 세팅에서 어떤 크루원이 배정됐든, 1교시는 새로운 count 기준으로 배정한다.

### 7.2 입실+조그 겸임

- 인원 부족 상황에서 한 크루원이 입실 후 조그를 이어서 수행할 수 있다.
- 이 경우 입실 count +1, 조그 count +1 모두 적용한다.

### 7.3 시험 예외 (시후)

- 시험이 있는 수업에 한해 시후 작업 추가 배정
- 시후 담당: 해당 교시 퇴실 담당자가 1차 후보
- 보통 2명 필요, 수업 시작 ~ +30분 소요

### 7.4 작업 교환

- 두 크루원 합의 시 배정된 작업을 서로 교환 가능
- 교환 시 count 조정: 각자 원래 작업 count -1, 새로운 작업 count +1
- count 조정으로 다음 배정 시 공평성 자동 유지

---

## 8. 비즈니스 규칙 요약표

| 규칙 | 내용 |
|------|------|
| 세팅은 오전만 | 미들은 09:00 출근이므로 세팅 불가 |
| 1교시 입실·조그는 오전만 | 작업 시작이 08:00~08:25이므로 미들 불가 |
| 1교시 퇴실부터 미들 참여 | 퇴실 시작 10:00, 미들 출근(09:00) 이후 |
| 2교시는 오전+미들 전체 | 모든 작업이 10:00 이후 시작 |
| 3교시 입실·조그는 오전+미들 | 작업 시작이 12:55~13:15 |
| 3교시 퇴실은 오후만 | 오후 크루 전담 (출근 14:20, 퇴실 14:50) |
| 4교시는 미들+오후 | 오전 크루 퇴근 후 |
| count는 pool 내부에서만 비교 | 다른 pool 크루끼리 count 비교 안 함 |
| 동일 count는 이름 오름차순 | 가나다순 정렬로 결정론적 배정 |

---

## 9. 향후 고려사항

- 크루원 출결 관리 (결근/지각 시 배정 가능 pool 재구성)
- 일일 스케줄 조회 API (크루원별 / 강의실별)
- 주간/월간 스케줄 일괄 생성
- 스케줄 알림 (작업 시작 N분 전 발송)
